main:
  name: example
  logger: zerolog
  author: educentr
  use_active_record: false

docker:
  image_prefix: registry.educentr.info

deploy:
  log_collector:
    type: loki
    parameters:
      - 'loki-url: "https://loki.educentr.info/loki/api/v1/push"'
      - "loki-retries: 2"
      - "loki-timeout: 4s"

post_generate:
  - git_install
  #- tools_install
  - clean_imports
  - executable_scripts
  - call_generate
  - go_mod_tidy
  #- go_get_u
  #- echo "post generate last job"

git:
  repo: git@gitlab.educentr.info:golang/projects/example.git
  module_path: gitlab.educentr.info/golang/projects/example
  # projectId: 1

tools:
  protobuf_version: 1.7.0
  golang_version: 1.21
  ogen_version: v0.78.0
  golangci_version: 1.55.2

rest:
  - name: example
    path:
      - ./example/example.swagger.yml
    api_prefix: /
    version: "v1"
    port: 8081
    generator_type: ogen
    genarator_params:
      auth_handler: "on"
  - name: sys
    port: 8085
    version: "v1"
    health_check_path: /live
    generator_type: template
    generator_template: sys

# worker:
#   - name: worker
#     generator_type: template
#     generator_template: worker

# cli:
#   - name: example_cli

# driver:
#   - name: clickhouse_batcher

# grpc:
#   - name: ExampleService
#     short: example
#     path: ./example/example.proto
#     port: 8083
#   - name: AdminService
#     short: admin
#     path: ./example/admin.proto
#     port: 8084

# repository:
#   - name: exampledb1
#     type_db: psql
#     driver_db: sqlc
# #  - name: exampledb2
# #    type_db: psql
# #    driver_db: sqlc
#   - name: examplecache
#     alias: Cache # important: case-sensitive
#     type_db: redis
#     driver_db: redis

# consumer:
#  - name: petstore
#    path: ./example/kafka_example.proto
#    backend: kafka
#    group: pets_store
#    topic: pets_store_events

applications:
  - name: publicApi
    transport:
      - example
      - sys
      #- ExampleService
    driver:
      # - clickhouse_batcher
    deploy:
      - volumes:
          - path: ./backupdata
            mount: /backup
  # - name: internalApi
  #   transport:
  #     - AdminService
  #     - sys
  # - name: cli
  #   transport:
  #     - example_cli
  # - name: worker
  #   transport:
  #     - worker
