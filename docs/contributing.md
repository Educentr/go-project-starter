# Участие в разработке

Мы приветствуем вклад в развитие проекта! Вот как вы можете помочь:

## Способы участия

- Баг репорты и исправления
- Запросы новых функций и их реализация
- Улучшение документации
- Новые шаблоны генераторов
- Улучшение покрытия тестами

## Workflow разработки

### 1. Клонирование репозитория

```bash
git clone https://github.com/Educentr/go-project-starter
cd go-project-starter
```

### 2. Установка зависимостей

```bash
go mod download
```

### 3. Сборка

```bash
# Сборка через Make
make build

# Или напрямую
go build -o go-project-starter ./cmd/go-project-starter
```

### 4. Локальная установка для тестирования

```bash
go install ./cmd/go-project-starter
```

### 5. Тестирование с примером

```bash
go-project-starter --config=example/config.yaml --target=/tmp/test-project
```

## Команды

```bash
# Сборка
make build

# Запуск тестов
make test                # С coverage
make race                # С race detector

# Linting (требуется golangci-lint v1.52.2)
make install-lint        # Установка golangci-lint
make lint                # Проверка изменений относительно origin/main
make lint-full           # Полный lint всего кода
make lint-fix            # Автоисправление

# Coverage отчёт
make coverage            # HTML отчёт
```

## Цикл разработки

1. Внесите изменения в код
2. `go install ./cmd/go-project-starter`
3. Протестируйте: `go-project-starter --config=example/config.yaml`
4. Запустите `make lint` перед коммитом
5. Повторите

## Структура проекта

```
go-project-starter/
├── cmd/go-project-starter/    # CLI точка входа
│   └── main.go
├── internal/pkg/
│   ├── config/                # Загрузка и валидация конфигов
│   │   ├── config.go
│   │   └── structs.go
│   ├── generator/             # Оркестрация генерации
│   │   └── generator.go
│   ├── templater/             # Движок шаблонов
│   │   ├── templater.go
│   │   ├── fs.go
│   │   ├── disclaimer.go
│   │   └── embedded/templates/
│   ├── meta/                  # Версионирование
│   └── ds/                    # Domain structures
├── example/                   # Примеры конфигураций
├── test/                      # Тесты
└── docs/                      # Документация
```

## Добавление нового шаблона

Шаблоны находятся в `internal/pkg/templater/embedded/templates/`:

### Структура шаблонов

```
templates/
├── main/              # Основные файлы проекта
│   ├── Makefile.tmpl
│   ├── Dockerfile.tmpl
│   └── ...
├── transport/
│   ├── rest/
│   │   ├── ogen/      # OpenAPI генератор
│   │   └── template/
│   │       └── sys/   # Системный шаблон
│   ├── grpc/
│   └── kafka/
├── worker/
│   └── template/
│       ├── telegram/
│       └── daemon/
├── app/
└── logger/
```

### Создание нового шаблона транспорта

1. Создайте директорию: `templates/transport/rest/template/{name}/`
2. Добавьте файлы шаблонов (`.tmpl`)
3. Зарегистрируйте в `templater/fs.go`
4. Добавьте тесты
5. Обновите документацию

### Синтаксис шаблонов

Используется стандартный Go `text/template`:

```go
package {{ .PackageName }}

// Generated by go-project-starter
// Version: {{ .Version }}

type {{ .StructName }} struct {
    {{- range .Fields }}
    {{ .Name }} {{ .Type }} `json:"{{ .JSONName }}"`
    {{- end }}
}
```

### Важные переменные шаблонов

| Переменная | Описание |
|------------|----------|
| `.ProjectName` | Имя проекта из конфига |
| `.ModulePath` | Go module path |
| `.Version` | Версия API |
| `.Port` | Порт транспорта |
| `.RestName` | Имя REST транспорта |

## Правила валидации

При добавлении новых настроек конфига обязательно добавьте валидацию в `config/structs.go`:

```go
func (c *Config) Validate() error {
    // Проверка обязательных полей
    if c.Main.Name == "" {
        return errors.New("main.name is required")
    }

    // Проверка на дубликаты
    names := make(map[string]bool)
    for _, rest := range c.Rest {
        if names[rest.Name] {
            return fmt.Errorf("duplicate rest name: %s", rest.Name)
        }
        names[rest.Name] = true
    }

    return nil
}
```

## Тестирование

### Unit тесты

```bash
go test ./internal/pkg/...
```

### Integration тесты

```bash
go test ./test/...
```

### Тестирование генерации

```bash
# Dry-run для просмотра изменений
go-project-starter --dry-run --config=example/config.yaml --target=/tmp/test

# Полная генерация
go-project-starter --config=example/config.yaml --target=/tmp/test

# Проверка компиляции
cd /tmp/test && go build ./...
```

## Важные правила

### При каждом релизе

Обновите `MinRuntimeVersion` в `internal/pkg/templater/templater.go`:

```go
const MinRuntimeVersion = "vX.Y.Z"  // Последняя версия runtime
```

1. Проверьте последний тег в go-project-starter-runtime
2. Обновите константу
3. Обновление go.mod и MinRuntimeVersion должны быть в одном коммите

### Правила коммитов

- Используйте осмысленные сообщения коммитов
- Один коммит = одно логическое изменение
- Запускайте `make lint` перед коммитом

### Code Review

- Все изменения проходят через PR
- Нужен как минимум один approve
- CI должен проходить

## Ресурсы

- [GitHub Issues](https://github.com/Educentr/go-project-starter/issues) — баг репорты и feature requests
- [GitHub Discussions](https://github.com/Educentr/go-project-starter/discussions) — вопросы и обсуждения

## Сообщество

- Делитесь своими конфигурациями и примерами
- Помогайте с ответами на вопросы в Issues/Discussions
- Участвуйте в обсуждении roadmap
- Менторьте новичков

## Лицензия

Проект распространяется под MIT лицензией. Внося вклад, вы соглашаетесь с её условиями.
