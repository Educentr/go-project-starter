  go-project-starter init --target=.
=== Go Project Starter - Project Initialization ===

--- Basic Information ---
? Project name (lowercase, no spaces): example_telegram_bot
? Logger: zerolog
? Docker registry type: github

? Git repository URL (e.g., <git@github.com>:owner/repo.git): <git@github.com>:Educentr/example-telegram-bot.git
? Go module path: github.com/Educentr/example-telegram-bot

--- Project Type ---
? What type of project? Telegram Bot

--- Telegram Bot Configuration ---
? Bot application name: example_bot

Configuration saved to .project-config/project.yaml

Next steps:

  1. Review and customize project.yaml
  2. Run: go-project-starter --configDir=.project-config --target=.
  3. Run: go-project-starter setup --configDir=.project-config --target=.

$ go-project-starter setup
=== Go Project Starter Setup Wizard ===

? Admin email (for certbot and notifications): <nikolas@educentr.info>
ℹ Detected CI provider: github
? Repository (owner/repo): Educentr/example-telegram-bot
ℹ Using registry type from project.yaml: github

--- Servers ---
? How many deployment servers? 1

--- Server 1 ---
? Server name (logical identifier): production
? Server host (IP or hostname): 128.140.2.112
? SSH port: 22
? SSH user (for initial setup): root
? Deploy user (will be created): deploy

--- Applications ---

Detected applications from project.yaml:

  1. example_bot [SINGLETON]
? Configure port prefixes for applications? No

--- Environments ---
? How many environments? (production, staging, etc.) 1

--- Environment 1 ---
? Environment name: production
? Git branch: main
? Use OnlineConf for configuration management? No
ℹ OnlineConf disabled - service will use environment variables
? Does your infrastructure have an internal network? No
⚠ WARNING: Without internal network, diagnostic endpoints (sys) will be exposed publicly!
⚠ Consider using firewall rules to restrict access to port 8085 (metrics/health)

  Deployment mapping (which apps run on which servers):
ℹ All applications will be deployed to production

--- Notifications ---
? Enable Telegram notifications? No
? Enable Slack notifications? No
✓ Configuration saved to setup.yaml

--- CI/CD Setup ---
ℹ GitHub CLI (gh) detected. Will use it to configure secrets and variables.

Configuring GitHub secrets...

--- Secret: SSH_PRIVATE_KEY ---
Description: Private SSH key for deploying to servers (generated by setup or your own)
? SSH_PRIVATE_KEY is not configured. What would you like to do? Generate new SSH key
ℹ Generating new SSH deploy key...
✓ SSH key generated: /home/nikolas/.ssh/example_telegram_bot_deploy_id_rsa

Public key (add to server's authorized_keys for deploy user):
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDufLvX2ESHkOMp+ogpdZjM6q04tfI/FhJulwm7H15Q7KTQ1okJGcpO+dykjYAmK3gUsYlGbTWqlcRA5zyXFh/5EVW5BOxbAGDKpRNop0XSaT04ZxcDfMsTcEN+VNG6j0XBJ/PCyKLBqrlfzOunWcKMefy0dsALjsQYqRxLpsjgEFa7/dotcwJlW37idZ2VdqVW8R1s3mc5kW215OEZYfuqx0jgh6u2IEF7jr0E5Xm+SH1bMw/DvvtqfvjLvwktQ+5W+stP89TdCcaYek7GLF/nHEJtJMqQwf3JjVq/0MQECA99KhsXJhjLdaC7ggvMR8T4AYnNzg+/5uGEzxgy6l5tQncbrpjjlru5hFbroevMFw8arn7aZmG+x5kAZlqTxZMZAxSHiLsoFFQn2e/Q2/sFrR0ljWtRU8qpEkqeVU3V2/lyxyadiBH3pXp1GfYyEf6brWBREDHLXvBe3KTfH9BQBdUZVDSO0gOSnaG2h3nug7shOqaT3xI/9U5bjX1sY2s= nikolas@NikolasHP

ℹ Uploading SSH private key to GitHub...
✓ SSH_PRIVATE_KEY uploaded to GitHub secrets
✓ Set secret: SSH_USER
✓ Set secret: REGISTRY_LOGIN_SERVER
✓ Set secret: GHCR_USER

--- Secret: GHCR_TOKEN ---
Description: GitHub token with write:packages scope for pushing images
Create at: <https://github.com/settings/tokens/new?scopes=repo,write:packages,read:packages>
Enter value: ghp_YOUR_TOKEN_HERE
✓ Set secret: GHCR_TOKEN

Configuring GitHub variables...
✓ Set variable: REGISTRY_CONTAINER
✓ Set variable: MAIN_ENABLED
✓ Set variable: MAIN_SSH_HOST
✓ Set variable: MAIN_ENV_TYPE
✓ Set variable: MAIN_APPS_0
✓ Set variable: MAIN_PORT_PREFIX_EXAMPLE_BOT

--- Verifying GitHub configuration ---
✓ All secrets and variables are configured!

--- Server Setup ---

=== Setting up server: production (128.140.2.112) ===
✓ SSH access to 128.140.2.112 verified
ℹ SSH key already exists: /home/nikolas/.ssh/example_telegram_bot_production_deploy_id_rsa
? Upload this SSH key to GitHub as SSH_PRIVATE_KEY secret? Yes
ℹ Uploading SSH private key to GitHub...
✓ SSH_PRIVATE_KEY uploaded to GitHub secrets
ℹ Updating system packages...
Hit:1 <https://download.docker.com/linux/ubuntu> noble InRelease
Hit:2 <https://mirror.hetzner.com/ubuntu/packages> noble InRelease
Hit:3 <https://mirror.hetzner.com/ubuntu/packages> noble-updates InRelease
Hit:4 <https://mirror.hetzner.com/ubuntu/packages> noble-backports InRelease
Hit:5 <https://mirror.hetzner.com/ubuntu/security> noble-security InRelease
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following upgrades have been deferred due to phasing:
  kpartx multipath-tools
The following packages have been kept back:
  linux-image-virtual
0 upgraded, 0 newly installed, 0 to remove and 3 not upgraded.
✓ Updating system packages completed
ℹ Creating deploy user...
fatal: The user `deploy' already exists.
✗ Failed: exit status 11

Run these commands manually:
Please run the following commands manually:

```bash
adduser --ingroup www-data --comment "GitHub deployer" --disabled-password deploy
cd /home/deploy
mkdir -p .ssh
echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCZszn+pqJAx+lXKfmq3mAIoNiL+bXBlAh4PIzGopBMwTD/2+Vl0XRaBMCEcmpcA9fa4LYKoYhYU4UVz+/6AwwSbjb4zAo5ypQ1Io3PBIiitUyRxP3fNlZgaxWjcB3FsOSdia8GXoLZ/9qs54faqIWkKXPFcz8umcX0HD20JoEKl4vcoqnpbDPuDUQ6I7oTkXCjyHRgVXBkgnc4M5EYXJJZpMxnpIoQRL73AS7n9PY6OVVS74en0P4kqSTOnlFsaZe8YiOgA8KuPqzWh+HKzN9jTXX0Vf7YQvbdSRENKHBghalgTGcks97oj4ie+zYEunmZodf551AQqhxokXj64NkeKaeTCQO9hjTfojxMrO/DKLHelmBv+OsXFoFCzyoeFODCWJzncSB09tXffoSkIBG9vxARZnR1KKQR/LPZPJOYFhMscGvaZ7w/gcvsUtNvMOjqg8O04h2Vo0+bEn+hBJduWQUdZNnY5Klw7qJld/+2vfq86qsbO61/5we5I48l6WU= nikolas@NikolasHP' > .ssh/authorized_keys
chown -R deploy:www-data /home/deploy/.ssh
chmod 700 .ssh
chmod 600 .ssh/authorized_keys
```

ℹ Installing Docker...
Reading package lists...
Building dependency tree...
Reading state information...
ca-certificates is already the newest version (20240203).
curl is already the newest version (8.5.0-2ubuntu10.6).
0 upgraded, 0 newly installed, 0 to remove and 3 not upgraded.
Hit:1 <https://download.docker.com/linux/ubuntu> noble InRelease
Hit:2 <https://mirror.hetzner.com/ubuntu/packages> noble InRelease
Hit:3 <https://mirror.hetzner.com/ubuntu/packages> noble-updates InRelease
Hit:4 <https://mirror.hetzner.com/ubuntu/packages> noble-backports InRelease
Hit:5 <https://mirror.hetzner.com/ubuntu/security> noble-security InRelease
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
docker-ce is already the newest version (5:29.1.5-1~ubuntu.24.04~noble).
docker-ce-cli is already the newest version (5:29.1.5-1~ubuntu.24.04~noble).
containerd.io is already the newest version (2.2.1-1~ubuntu.24.04~noble).
docker-buildx-plugin is already the newest version (0.30.1-1~ubuntu.24.04~noble).
docker-compose-plugin is already the newest version (5.0.1-1~ubuntu.24.04~noble).
0 upgraded, 0 newly installed, 0 to remove and 3 not upgraded.
Synchronizing state of docker.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.
Executing: /usr/lib/systemd/systemd-sysv-install enable docker
✓ Installing Docker completed
ℹ Installing Loki Docker plugin (optional)...
ℹ Installing Loki plugin...
Error response from daemon: plugin loki:latest already exists
✗ Failed: exit status 1

Run these commands manually:
Please run the following commands manually:

```bash
docker plugin install grafana/loki-docker-driver:latest --alias loki --grant-all-permissions
```

ℹ Installing docker-rollout plugin...
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  6114  100  6114    0     0  25864      0 --:--:-- --:--:-- --:--:-- 25906
✓ Installing docker-rollout plugin completed

Configure Docker registry login (github):
Please run the following commands manually:

```bash
echo "<GHCR_TOKEN>" | sudo -u deploy docker login ghcr.io -u <GHCR_USER> --password-stdin
```

ℹ Creating directory structure...
✓ Creating directory structure completed

--- Deploy Script ---
✓ Generated deploy script: scripts/deploy.sh

--- Deploy Script Installation ---
Copy the deploy.sh script to /opt/example_telegram_bot-cd/ on your servers:
  scp scripts/deploy.sh user@server:/opt/example_telegram_bot-cd/deploy.sh

=== Setup Complete ===

--- Next Steps ---

1. Configure application environment:
   - Edit .env-example_bot with your application settings

2. Commit and push your changes:
   git add .
   git commit -m "Setup CI/CD for example_telegram_bot"
   git push

3. Verify the deployment:
   - Check GitHub Actions / GitLab CI pipeline
   - Monitor the first deployment
   - After deploy, check health endpoints:
     <http://128.140.2.112:8085/health> (example_bot)

If something goes wrong:

- Check CI/CD logs for build/deploy errors
- SSH to server: docker ps, docker logs <container>
