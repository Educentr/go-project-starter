package rest

import (
	"context"
	"net/http"
	"time"

	"github.com/prometheus/client_golang/prometheus"

	"github.com/Educentr/go-project-starter-runtime/pkg/ds"
)

//type Client interface {
//	GetHTTPClient(timeout time.Duration) *http.Client
//	GetMiddlewares(ctx context.Context, appName string, metrics *prometheus.Registry, srv ds.IService, serviceName string, errHdl RestErrorHandler) ([]func(next http.Handler) http.Handler, error)
//}

type Router interface {
	InitRouters(ctx context.Context, httpSrv *http.Server, srv ds.IService, metrics *prometheus.Registry) error
	// GetMiddlewares returns middleware chain for REST server.
	// Parameters:
	// - appName: Application.Name (e.g., "web-app") - the specific application instance
	// - serviceName: Main.Name (e.g., "my-api") - the service-level name (constant.ServiceName)
	// - transportName: Transport.Name (e.g., "api_v1") - the REST transport name
	GetMiddlewares(ctx context.Context, appName string, metrics *prometheus.Registry, srv ds.IService, serviceName, transportName string, errHdl RestErrorHandler) ([]func(next http.Handler) http.Handler, error)
	GetErrorHandler() RestErrorHandler
}

type RestErrorHandler interface {
	UnexpectedError(ctx context.Context, w http.ResponseWriter, r *http.Request, errHdl error)
	NotFoundError(w http.ResponseWriter, r *http.Request)
	NotAuthorizedError(w http.ResponseWriter, r *http.Request)
}

const (
	ContentTypeHeader = "Content-Type"
	ContentTypeJSON   = "application/json"
)

var (
	defaultHTTPTimeout = 2 * time.Second
	defaultListenIP    = "0.0.0.0"
)

type EmptyErrorHandler struct{}

func (e *EmptyErrorHandler) GetErrorHandler() RestErrorHandler {
	return e
}

func (e *EmptyErrorHandler) UnexpectedError(_ context.Context, _ http.ResponseWriter, _ *http.Request, _ error) {
	panic("Unimplemented")
}

func (e *EmptyErrorHandler) NotFoundError(_ http.ResponseWriter, _ *http.Request) {
	panic("Unimplemented")
}

func (e *EmptyErrorHandler) NotAuthorizedError(_ http.ResponseWriter, _ *http.Request) {
	panic("Unimplemented")
}