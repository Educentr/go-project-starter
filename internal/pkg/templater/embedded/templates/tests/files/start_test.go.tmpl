package {{ .Application.Name | ToLower }}_test

import (
	"net/http"
	"testing"

	"github.com/stretchr/testify/suite"
)

// StartTestSuite verifies the application starts successfully
type StartTestSuite struct {
	BaseTestSuite
}

// TestApplicationStarts verifies the application boots and responds to health checks
func (s *StartTestSuite) TestApplicationStarts() {
	// Verify sys/health endpoint responds
	client := NewHTTPClient(GetAPIURL(sysPort))
	resp, body := client.Get(s.T(), "/ready")

	s.Require().Equal(http.StatusOK, resp.StatusCode,
		"Health check should return 200 OK, got: %s", string(body))
}
{{ range $_, $tr := .Application.GetRestTransport }}{{ if and (ne $tr.Name "sys") (ne $tr.GeneratorType "ogen_client") }}
// Test{{ $tr.Name | Capitalize }}Available verifies {{ $tr.Name }} transport is reachable
func (s *StartTestSuite) Test{{ $tr.Name | Capitalize }}Available() {
	client := NewHTTPClient(GetAPIURL("{{ $tr.Port }}"))

	// Try to connect to the API (404 is acceptable, means server is running)
	resp, _ := client.Get(s.T(), "/")

	s.Assert().True(resp.StatusCode < 500,
		"API should be running, status code: %d", resp.StatusCode)
}
{{ end }}{{ end }}
// TestStartTestSuite runs the start test suite
func TestStartTestSuite(t *testing.T) {
	suite.Run(t, new(StartTestSuite))
}
