// Code generated by go-project-starter. DO NOT EDIT.
package tests

import (
	gtt "github.com/Educentr/goat"
	"github.com/Educentr/goat/testutil"
)

// TestEnvInitializer is the interface for initializing test environment.
// Implement this interface in your init.go to customize test setup.
type TestEnvInitializer interface {
	InitTestEnv() (testutil.TestAppConfig, *gtt.Env)
}

// defaultTestEnvInitializer is the default implementation with panic.
// It will be replaced by user's implementation in init.go
type defaultTestEnvInitializer struct{}

func (d *defaultTestEnvInitializer) InitTestEnv() (testutil.TestAppConfig, *gtt.Env) {
	panic(`TestEnvInitializer not implemented.

Create init.go with your implementation:

    package tests

    import (
        "path/filepath"

        gtt "github.com/Educentr/goat"
        "github.com/Educentr/goat/services"
        "github.com/Educentr/goat-services/psql"
        "github.com/Educentr/goat-services/xray"

        "github.com/Educentr/goat/testutil"
    )

    type testEnvInitializerImpl struct{}

    func (t *testEnvInitializerImpl) InitTestEnv() (testutil.TestAppConfig, *gtt.Env) {
        // 1. Create app config
        config := New{{ .ProjectName | Capitalize }}Config()

        // 2. Register services
        services.MustRegisterServiceFuncTyped("postgres", psql.Run)
        services.MustRegisterServiceFuncTyped("xray", xray.Run)

        // 3. Configure service options
        configPath, _ := filepath.Abs("etc/xray-config.json")
        servicesMap := services.NewServicesMap("postgres", "xray").
            WithOptions("xray", xray.WithConfigFile(configPath))

        // 4. Create environment
        manager := services.NewManager(servicesMap, services.DefaultManagerConfig())
        env := gtt.NewEnv(gtt.EnvConfig{}, manager)

        return config, env
    }

    func init() {
        testEnvInit = &testEnvInitializerImpl{}
    }
`)
}

// testEnvInit is the current TestEnvInitializer implementation.
// By default it's defaultTestEnvInitializer with panic.
// Override it in your init.go by assigning a new implementation.
var testEnvInit TestEnvInitializer = &defaultTestEnvInitializer{}
